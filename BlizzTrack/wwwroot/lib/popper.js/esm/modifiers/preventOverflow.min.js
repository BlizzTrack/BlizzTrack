import{top,left,right,bottom,start}from"../enums.js";import getBasePlacement from"../utils/getBasePlacement.js";import getMainAxisFromPlacement from"../utils/getMainAxisFromPlacement.js";import getAltAxis from"../utils/getAltAxis.js";import within from"../utils/within.js";import getLayoutRect from"../dom-utils/getLayoutRect.js";import getOffsetParent from"../dom-utils/getOffsetParent.js";import detectOverflow from"../utils/detectOverflow.js";import getVariation from"../utils/getVariation.js";import getFreshSideObject from"../utils/getFreshSideObject.js";function preventOverflow(t){var e=t.state,i=t.options,r=t.name,o=i.mainAxis,a=void 0===o||o,s=i.altAxis,n=void 0!==s&&s,m=i.boundary,f=i.rootBoundary,l=i.altBoundary,p=i.padding,d=i.tether,g=void 0===d||d,c=i.tetherOffset,u=void 0===c?0:c,h=detectOverflow(e,{boundary:m,rootBoundary:f,padding:p,altBoundary:l}),w=getBasePlacement(e.placement),v=getVariation(e.placement),O=!v,j=getMainAxisFromPlacement(w),y=getAltAxis(j),x=e.modifiersData.popperOffsets,b=e.rects.reference,A=e.rects.popper,P="function"==typeof u?u(Object.assign(Object.assign({},e.rects),{},{placement:e.placement})):u,B={x:0,y:0};if(x){if(a){var D="y"===j?top:left,F="y"===j?bottom:right,M="y"===j?"height":"width",L=x[j],R=x[j]+h[D],S=x[j]-h[F],V=g?-A[M]/2:0,q=v===start?b[M]:A[M],E=v===start?-A[M]:-b[M],I=e.elements.arrow,T=g&&I?getLayoutRect(I):{width:0,height:0},k=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:getFreshSideObject(),z=k[D],C=k[F],G=within(0,b[M],T[M]),H=O?b[M]/2-V-G-z-P:q-G-z-P,J=O?-b[M]/2+V+G+C+P:E+G+C+P,K=e.elements.arrow&&getOffsetParent(e.elements.arrow),N=K?"y"===j?K.clientTop||0:K.clientLeft||0:0,Q=e.modifiersData.offset?e.modifiersData.offset[e.placement][j]:0,U=x[j]+H-Q-N,W=x[j]+J-Q,X=within(g?Math.min(R,U):R,L,g?Math.max(S,W):S);x[j]=X,B[j]=X-L}if(n){var Y="x"===j?top:left,Z="x"===j?bottom:right,$=x[y],_=$+h[Y],tt=$-h[Z],et=within(_,$,tt);x[y]=et,B[y]=et-$}e.modifiersData[r]=B}}export default{name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]};